_format_version: "3.0"

services:
  # ── User Service ──────────────────────────────────────────────────────────
  - name: user-service
    url: http://user-service:3001
    routes:
      - name: auth-routes
        paths:
          - /api/v1/auth
        strip_path: false
      - name: user-routes
        paths:
          - /api/v1/users
        strip_path: false

  # ── Event Service ─────────────────────────────────────────────────────────
  - name: event-service
    url: http://event-service:3002
    routes:
      - name: event-routes
        paths:
          - /api/v1/events
        strip_path: false
      - name: venue-routes
        paths:
          - /api/v1/venues
        strip_path: false

  # ── Booking Service ───────────────────────────────────────────────────────
  - name: booking-service
    url: http://booking-service:3003
    routes:
      - name: booking-routes
        paths:
          - /api/v1/bookings
        strip_path: false

  # ── Payment Service ───────────────────────────────────────────────────────
  - name: payment-service
    url: http://payment-service:3004
    routes:
      - name: payment-routes
        paths:
          - /api/v1/payments
        strip_path: false
      - name: webhook-routes
        paths:
          - /api/v1/webhooks
        strip_path: false

  # ── Search Service ────────────────────────────────────────────────────────
  - name: search-service
    url: http://search-service:3005
    routes:
      - name: search-routes
        paths:
          - /api/v1/search
        strip_path: false

  # ── Cart Service ──────────────────────────────────────────────────────────
  - name: cart-service
    url: http://cart-service:3007
    routes:
      - name: cart-routes
        paths:
          - /api/v1/cart
        strip_path: false

  # ── Waitlist Service ──────────────────────────────────────────────────────
  - name: waitlist-service
    url: http://waitlist-service:3008
    routes:
      - name: waitlist-routes
        paths:
          - /api/v1/waitlist
        strip_path: false

plugins:
  - name: cors
    config:
      origins:
        - "*"
      methods:
        - GET
        - POST
        - PUT
        - PATCH
        - DELETE
        - OPTIONS
      headers:
        - Content-Type
        - Authorization
        - Idempotency-Key
      exposed_headers:
        - X-Request-Id
      max_age: 3600
      credentials: true

  - name: rate-limiting
    config:
      minute: 120
      policy: local
      fault_tolerant: true
      hide_client_headers: false

  - name: correlation-id
    config:
      header_name: X-Request-Id
      generator: uuid
      echo_downstream: true
